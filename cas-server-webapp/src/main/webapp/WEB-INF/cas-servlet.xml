<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:flow="http://www.springframework.org/schema/webflow-config"       
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/webflow-config
http://www.springframework.org/schema/webflow-config/spring-webflow-config-1.0.xsd">
       
	<!-- Theme Resolver -->
	<bean
		id="themeResolver"
		class="org.jasig.cas.services.web.ServiceThemeResolver">
		<property
			name="defaultThemeName"
			value="default" />
	</bean>

	<!-- View Resolver -->
	<bean
		id="viewResolver"
		class="org.springframework.web.servlet.view.ResourceBundleViewResolver">
		<property
			name="basename"
			value="default_views" />
		<property
			name="order"
			value="0" />
	</bean>
	
	<!-- Locale Resolver -->
	<bean
		id="localeResolver"
		class="org.springframework.web.servlet.i18n.CookieLocaleResolver" />
		
	<bean
		id="localeChangeInterceptor"
		class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor" />
	
	<bean
		id="urlBasedViewResolver"
		class="org.springframework.web.servlet.view.UrlBasedViewResolver">
		<property
			name="viewClass"
			value="org.springframework.web.servlet.view.AbstractUrlBasedView" />
	</bean>
	
	<bean
		id="errorHandlerResolver" 
		class="org.jasig.cas.web.NoSuchFlowExecutionExceptionResolver" />

	<!-- Handler Mapping -->
	<bean
		id="handlerMappingA"
		class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property
			name="mappings">
			<props>
				<prop
					key="/login">
					loginController
				</prop>
			</props>
		</property>
		<property
			name="interceptors">
			<list>
				<ref bean="localeChangeInterceptor" />
			</list>
		</property>
	</bean>
		
	<bean
		id="handlerMappingB"
		class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property
			name="mappings">
			<props>
				<prop
					key="/logout">
					logoutController
				</prop>
				<prop
					key="/serviceValidate">
					serviceValidateController
				</prop>
				<prop
					key="/validate">
					legacyValidateController
				</prop>
				<prop
					key="/proxy">
					proxyController
				</prop>
				<prop
					key="/proxyValidate">
					proxyValidateController
				</prop>
				<prop
					key="/samlValidate">
					samlValidateController
				</prop>
				<!--
				uncomment this to enable remote access to web service 
				<prop
					key="/CentralAuthenticationService">
					xFireCentralAuthenticationService
				</prop>
				 -->
			</props>
		</property>
		<!--
		uncomment this to enable sending PageRequest events. 
		<property
			name="interceptors">
			<list>
				<ref bean="pageRequestHandlerInterceptorAdapter" />
			</list>
		</property>
		 -->
	</bean>

	<bean
		id="loginController"
		class="org.springframework.webflow.executor.mvc.FlowController">
		<property name="flowExecutor" ref="flowExecutor"/>
		<property
			name="defaultFlowId"
			value="login-webflow" />
		<property
			name="argumentExtractor">
			<bean
				class="org.springframework.webflow.executor.support.FlowExecutorArgumentExtractor">
				<property
					name="flowExecutionKeyParameterName"
					value="lt" />
				<property
					name="defaultFlowId"
					value="login-webflow" />
			</bean>
		</property>
	</bean>

	<flow:executor id="flowExecutor" registry-ref="flowRegistry">
		<flow:execution-attributes>
			<flow:alwaysRedirectOnPause value="false"/>
		</flow:execution-attributes>
	</flow:executor>

	<flow:registry id="flowRegistry">
		<flow:location path="/WEB-INF/login-webflow.xml"/>
	</flow:registry>

	<bean id="proxyValidateController"
		class="org.jasig.cas.web.ServiceValidateController">
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="proxyHandler"
			ref="proxy20Handler" />
		<property
			name="argumentExtractor"
			ref="casArgumentExtractor" />
	</bean>

	<bean
		id="serviceValidateController"
		class="org.jasig.cas.web.ServiceValidateController">
		<property
			name="validationSpecificationClass"
			value="org.jasig.cas.validation.Cas20WithoutProxyingValidationSpecification" />
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="proxyHandler"
			ref="proxy20Handler" />
		<property
			name="argumentExtractor"
			ref="casArgumentExtractor" />
	</bean>
	
	<bean
		id="samlValidateController"
		class="org.jasig.cas.web.ServiceValidateController">
		<property
			name="validationSpecificationClass"
			value="org.jasig.cas.validation.Cas20WithoutProxyingValidationSpecification" />
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="proxyHandler"
			ref="proxy20Handler" />
		<property
			name="argumentExtractor"
			ref="samlArgumentExtractor" />
		<property
			name="successView"
			value="casSamlServiceSuccessView" />
		<property
			name="failureView"
			value="casSamlServiceFailureView" />
	</bean>

	<bean
		id="legacyValidateController"
		class="org.jasig.cas.web.ServiceValidateController">
		<property
			name="proxyHandler"
			ref="proxy10Handler" />
		<property
			name="successView"
			value="cas1ServiceSuccessView" />
		<property
			name="failureView"
			value="cas1ServiceFailureView" />
		<property
			name="validationSpecificationClass"
			value="org.jasig.cas.validation.Cas10ProtocolValidationSpecification" />
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="argumentExtractor"
			ref="casArgumentExtractor" />
	</bean>

	<bean
		id="proxyController"
		class="org.jasig.cas.web.ProxyController">
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
	</bean>

	<bean
		id="logoutController"
		class="org.jasig.cas.web.LogoutController">
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="logoutView"
			value="casLogoutView" />
		<property 
			name="warnCookieGenerator"
			ref="warnCookieGenerator" />
		<property
			name="ticketGrantingTicketCookieGenerator"
			ref="ticketGrantingTicketCookieGenerator" />
	</bean>
<!--
uncomment this to allow access to web service
	<bean
		id="xFireCentralAuthenticationService"
		class="org.codehaus.xfire.spring.remoting.XFireExporter">
		<property
			name="serviceBean"
			ref="remoteCentralAuthenticationService" />
		<property
			name="serviceInterface"
			value="org.jasig.cas.CentralAuthenticationService" />
		<property
			name="serviceFactory"
			ref="xfire.serviceFactory" />
		<property
			name="xfire"
			ref="xfire" />
	</bean>

	<bean
		id="remoteCentralAuthenticationService"
		class="org.jasig.cas.remoting.server.RemoteCentralAuthenticationService">
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="validators">
			<list>
				<bean
					class="org.jasig.cas.validation.UsernamePasswordCredentialsValidator" />
			</list>
		</property>
	</bean>
-->
	<bean
		id="simpleMappingHandlerExceptionResolver"
		class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
		<property
			name="exceptionMappings">
			<props>
				<prop
					key="UndeclaredThrowableException">
					serviceErrorView
				</prop>
			</props>
		</property>
	</bean>
	
	<bean
		id="extractServiceAction"
		class="org.jasig.cas.web.flow.ExtractServiceAction">
		<property
			name="argumentExtractors"
			ref="argumentExtractors" />
	</bean>
	
	<bean
		id="automaticCookiePathSetterAction"
		class="org.jasig.cas.web.flow.AutomaticCookiePathSetterAction">
		<property
			name="warnCookieGenerator"
			ref="warnCookieGenerator" />
		<property
			name="ticketGrantingTicketCookieGenerator"
			ref="ticketGrantingTicketCookieGenerator" />
	</bean>
	
	<bean
		id="authenticationViaFormAction"
		class="org.jasig.cas.web.flow.AuthenticationViaFormAction">
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="argumentExtractors"
			ref="argumentExtractors" />
		<property
			name="warnCookieGenerator"
			ref="warnCookieGenerator" />
		<property
			name="ticketGrantingTicketCookieGenerator"
			ref="ticketGrantingTicketCookieGenerator" />
	</bean>
	
	<bean
		id="generateServiceTicketAction"
		class="org.jasig.cas.web.flow.GenerateServiceTicketAction">
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="ticketGrantingTicketCookieGenerator"
			ref="ticketGrantingTicketCookieGenerator" />
	</bean>
		
	<bean
		id="sendTicketGrantingTicketAction"
		class="org.jasig.cas.web.flow.SendTicketGrantingTicketAction">
		<property
			name="centralAuthenticationService"
			ref="centralAuthenticationService" />
		<property
			name="ticketGrantingTicketCookieGenerator"
			ref="ticketGrantingTicketCookieGenerator" />
	</bean>
		
	<bean
		id="ticketGrantingTicketExistsAction"
		class="org.jasig.cas.web.flow.TicketGrantingTicketExistsAction">
		<property
			name="ticketGrantingTicketCookieGenerator"
			ref="ticketGrantingTicketCookieGenerator" />
	</bean>
		
	<bean
		id="warnAction"
		class="org.jasig.cas.web.flow.WarnAction">
		<property
			name="warnCookieGenerator"
			ref="warnCookieGenerator" />
		<property
			name="ticketGrantingTicketCookieGenerator"
			ref="ticketGrantingTicketCookieGenerator" />
	</bean>

<!--
	<bean
		id="x509Check"
		parent="abstractCasLoginAction"
		class="org.jasig.cas.adaptors.x509.web.flow.X509CertificateCredentialsNonInteractiveAction" />
 -->
 
 	<bean
 		id="casArgumentExtractor"
 		class="org.jasig.cas.web.support.CasArgumentExtractor" />
 	
 	<bean
 		id="samlArgumentExtractor"
 		class="org.jasig.cas.web.support.SamlArgumentExtractor" />
 		
 	<bean id="argumentExtractors" class="java.util.ArrayList">
 		<constructor-arg index="0">
 			<list>
 				<ref local="casArgumentExtractor" />
 				<ref local="samlArgumentExtractor" />
 			</list>
 		</constructor-arg>
 	</bean>
	
	<bean id="warnCookieGenerator" class="org.springframework.web.util.CookieGenerator">
		<property name="cookieSecure" value="true" />
		<property name="cookieMaxAge" value="-1" />
		<property name="cookieName" value="CASPRIVACY" />
		<property name="cookiePath" value="/cas" />
	</bean>
	
	<bean id="ticketGrantingTicketCookieGenerator" class="org.springframework.web.util.CookieGenerator">
		<property name="cookieSecure" value="true" />
		<property name="cookieMaxAge" value="-1" />
		<property name="cookieName" value="CASTGC" />
		<property name="cookiePath" value="/cas" />
	</bean>
	
	<bean id="dynamicRedirectViewSelector"
		class="org.jasig.cas.web.flow.DynamicRedirectViewSelector">
		<constructor-arg index="0"
			ref="argumentExtractors" />
	</bean>
</beans>